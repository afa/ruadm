Административные единицы России
===============================

Этот репозиторий содержит данные (и скрипты для их извлечения) по
административным единицам России (вплоть до уровня 4 — населённый пункт),
а также федеральным округам, в которые они входят.

Данные о населённых пунктах и административном делении извлекаются из базы
[КЛАДР](http://www.gnivc.ru/inf_provision/classifiers_reference/kladr/).

Данны о разбиении регионов по федеральным округам, остутствующие в КЛАДР,
извлекаются из [статьи Википедии](https://ru.wikipedia.org/wiki/%D0%A4%D0%B5%D0%B4%D0%B5%D1%80%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D0%BE%D0%BA%D1%80%D1%83%D0%B3%D0%B0_%D0%A0%D0%BE%D1%81%D1%81%D0%B8%D0%B9%D1%81%D0%BA%D0%BE%D0%B9_%D0%A4%D0%B5%D0%B4%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B8).

Данные могут быть полезны, например, для отрисовки статистики или для
создания форм регистрации пользователей с указанием места жительства.

## Описание данных

Описанные нижи файлы лежат в репозитории в папке data. Извлечь более
свежие данные можно с помощью скриптов, лежащих в папке script (инструкции
ниже).

Данные можно использовать, склонировав/скачав репозиторий, или забирать
онлайн через CDN rawgit, см. «Онлайн-использование данных»

Описание файлов с данными:

### kladr.csv (≈33 Мб)

Данные в CSV-формате. Колонки (заголовки есть в файле):
* `code` — код КЛАДР;
* `level` — уровень КЛАДР (1 — регион, 2 — район, 3 — город, 4 — населённый пункт);
* `type` — расшифровка уровня КЛАДР (соответственно region, raion, city, settlement);
* `name` — название (для регионов также см.колонку `region_wikiname`);
* `city_code` — для города — повторение КЛАДР-кода города; для посёлка,
  подчинённого городу — КЛАДР-код города, которому он подчинён;
* `city_name` — расшифровка `city_code`;
* `raion_code` — код района, в котором находится данный город/посёлок;
  для района — его собственный код;
* `raion_name` — расшифровка `raion_code`;
* `region_code` — код региона, в котором находится данный город/посёлок/район;
  для региона — его собственный код;
* `region_name` — расшировка `region_code`;
* `district` — название федерального округа, в который входит регион
  (без слов «ФО»/«федеральный округ»);
* `region_wikiname` — название региона согласно Википедии (обычно полнее
  и читабельнее названия по КЛАДР).

### kladr.json (≈56 Мб)

Те же данные, что в kladr.csv, в виде JSON-хеша (код КЛАДР → данные).
Один элемент хеша:

```json
{
  ...
  "6600000100000": {
    "code": "6600000100000",
    "level": 3,
    "type": "city",
    "name": "Екатеринбург",
    "district": "Уральский",
    "region": {
      "code": "6600000000000",
      "name": "Свердловская",
      "wikiname": "Свердловская область"
    },
    "city": {
      "code": "6600000100000",
      "name": "Екатеринбург"
    }
  }
  ...
}
```

### settlement2region.json (≈ 5 Мб)

Простой хеш для быстрого отображения названия населённого пункта в
название региона:
```json
{
  "Екатеринбург": "Свердловская"
}
```

### settlement2region2.json (≈ 5.6 Мб)

То же что предыдущее, но с названиями регионов из Википедии, а не КЛАДР
(более красивыми).
```json
{
  "Екатеринбург": "Свердловская область"
}
```

### settlement2district.json (≈ 5 Мб)

Простой хеш для быстрого отображения названия населённого пункта в
федеральный округ:
```json
{
  "Екатеринбург": "Уральский"
}
```

### city2region.json (≈ 320 Кб)

То же, что `settlement2region.json`, но только для административных
единиц уровня 3 (город) и выше.

### city2region2.json (≈ 420 Кб)

То же, что `settlement2region2.json`, но только для административных
единиц уровня 3 (город) и выше.

### city2district.json (≈ 320 Кб)

То же, что `settlement2district.json`, но только для административных
единиц уровня 3 (город) и выше.

## Онлайн-использование данных

CDN rawgit предоставляет доступ к данным онлайн.

Пример полезного URL:

Пример Ruby-кода, использующего данные:

```ruby
require 'json'
require 'open-uri'

data = JSON.parse(open('settlement2region2.json').read)
data['Зырянка'] # => 'Кемеровская область'
```

## Запуск скриптов

1. Скачайте данные КЛАДР отсюда: http://www.gnivc.ru/inf_provision/classifiers_reference/kladr/
2. Распакуйте и положите KLADR.DBF в `script/data`
3. Запустите скрипты в следующем порядке:

```bash
# извлекает csv из DBF
ruby script/dbf2csv.rb
# разбирает КЛАДР-коды
ruby script/parse_codes.rb
# извлекает федеральные округа
ruby script/extract_districts.rb
# сливает федеральные округа с данными КЛАДР и кладёт в data/kladr.csv
ruby script/merge-districts.rb
# делает JSON-файлы
ruby script/csv2json.rb
```

## Лицензия на данные

* [Лицензия на использование КЛАДР](http://www.gnivc.ru/inf_provision/classifiers_reference/kladr/);
* [Лицензия на использование данных Википедии](https://ru.wikipedia.org/wiki/%D0%92%D0%B8%D0%BA%D0%B8%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F:%D0%A2%D0%B5%D0%BA%D1%81%D1%82_%D0%BB%D0%B8%D1%86%D0%B5%D0%BD%D0%B7%D0%B8%D0%B8_Creative_Commons_Attribution-ShareAlike_3.0_Unported)

(Человеческими словами — данные в общем под свободной лицензией, но
если сомневаетесь — лучше почитайте по ссылкам.)

## Автор репозитория

[Виктор Шепелев](https://zverok.github.io)
